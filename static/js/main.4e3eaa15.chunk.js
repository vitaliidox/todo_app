(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var r,c=n(24),o=(n(33),n(34),n(35),n(36),n(11)),a=n(5),s=n(0),i=n.n(s),u=n(8),l=n.n(u);!function(e){e.Add="Add",e.Delete="Delete",e.Update="Update",e.Empty="Empty"}(r||(r={}));var d=n(2),f=function(e){var t=e.isError,n=e.setIsError;Object(s.useEffect)((function(){var e=setTimeout((function(){n(null)}),3e3);return function(){clearTimeout(e),n(null)}}),[]);var c=Object(s.useMemo)((function(){switch(t){case r.Add:return"Unable to add a todo";case r.Delete:return"Unable to delete a todo";case r.Update:return"Unable to update a todo";case r.Empty:return"Title can't be empty";default:return null}}),[t]),o=Object(s.useCallback)((function(){n(null)}),[]);return Object(d.jsxs)("div",{"data-cy":"errorNotification",className:l()("errorNotification",{hidden:!t}),children:[c,Object(d.jsx)("button",{"aria-label":"destroyButton","data-cy":"deleteTodo",type:"button",className:"destroyButton",onClick:o})]})},j=n(4),b=n.n(j),m=n(6),p="https://mate.academy/students-api";function h(e){return new Promise((function(t){setTimeout(t,e)}))}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={method:t};return n&&(r.body=JSON.stringify(n),r.headers={"Content-Type":"application/json; charset=UTF-8"}),h(300).then((function(){return fetch(p+e,r)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var v,x=function(e){return O(e)},g=function(e,t){return O(e,"POST",t)},y=function(e,t){return O(e,"PATCH",t)},N=function(e){return O(e,"DELETE")},k=function(e){return g("/todos",e)},C=function(e,t){return y("/todos/".concat(e),t)},E=function(e){return N("/todos/".concat(e))};!function(e){e.All="All",e.Active="Active",e.Completed="Completed"}(v||(v={}));var T=function(e){var t=e.filter,n=e.setFilter,r=Object(s.useCallback)((function(e){return function(){n(e)}}),[]);return Object(d.jsxs)("ul",{className:"filters",children:[Object(d.jsx)("li",{children:Object(d.jsx)(o.b,{to:"/",className:l()({selected:t===v.All}),onClick:r(v.All),children:"All"})}),Object(d.jsx)("li",{children:Object(d.jsx)(o.b,{to:"/active",className:l()({selected:t===v.Active}),onClick:r(v.Active),children:"Active"})}),Object(d.jsx)("li",{children:Object(d.jsx)(o.b,{to:"/completed",className:l()({selected:t===v.Completed}),onClick:r(v.Completed),children:"Completed"})})]})},w=function(e){var t=e.todos,n=e.setTodos,c=e.filter,o=e.setFilter,a=e.setIsError,i=Object(s.useCallback)((function(){t&&Promise.all(t.map(function(){var e=Object(m.a)(b.a.mark((function e(c){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.completed){e.next=3;break}return e.next=3,E(c.id).then((function(){return n(t.filter((function(e){return!e.completed})))})).catch((function(){return a(r.Delete)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}),[t]),u=Object(s.useMemo)((function(){var e=0;return t.forEach((function(t){t.completed||(e+=1)})),e}),[t]);return Object(d.jsxs)("footer",{className:"footer",children:[Object(d.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(u," items left")}),Object(d.jsx)(T,{setFilter:o,filter:c}),Object(d.jsx)("button",{type:"button",className:l()("clear-completed",{"clear-completed-hidden":!t.some((function(e){return e.completed}))}),onClick:i,children:"Clear completed"})]})},A=n(7),F=function(){var e=Object(m.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(m.a)(b.a.mark((function e(t){var n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,r=t.name,e.abrupt("return",g("/users",{email:n,name:r}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(e){var t=e.loading,n=e.errorMessage,r=e.needToRegister,c=e.name,o=e.setName;return Object(d.jsxs)("div",{className:"fieldRegister",children:[Object(d.jsx)("label",{className:"fieldRegister__label",htmlFor:"user-name",children:"Your Name"}),Object(d.jsx)("input",{type:"text",id:"user-name",className:l()("authForm__input",{"is-danger":r&&n}),placeholder:"Enter your name",required:!0,minLength:4,disabled:t,value:c,onChange:function(e){return o(e.target.value)}}),r&&n&&Object(d.jsx)("p",{className:"is-danger",children:n})]})},L=function(e){var t=e.onLogin,n=Object(s.useState)(""),r=Object(a.a)(n,2),c=r[0],o=r[1],i=Object(s.useState)(""),u=Object(a.a)(i,2),f=u[0],j=u[1],p=Object(s.useState)(!1),h=Object(a.a)(p,2),O=h[0],v=h[1],x=Object(s.useState)(!1),g=Object(a.a)(x,2),y=g[0],N=g[1],k=Object(s.useState)(""),C=Object(a.a)(k,2),E=C[0],T=C[1],w=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(s.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(r){throw new Error("Need to login")}}),[]);var A=function(){var e=Object(m.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(c);case 2:(t=e.sent)?w(t):v(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(m.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),T(""),N(!0),e.prev=3,!O){e.next=9;break}return e.next=7,S({name:f,email:c}).then(w);case 7:e.next=11;break;case 9:return e.next=11,A();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),T("Something went wrtong");case 16:return e.prev=16,N(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)("form",{onSubmit:L,className:"authForm",children:[Object(d.jsx)("h1",{className:"title-suthForm",children:O?"You need to register":"Log in to open todos"}),Object(d.jsxs)("div",{className:"fieldRegister",children:[Object(d.jsx)("label",{className:"fieldRegister__label",htmlFor:"user-email",children:"Email"}),Object(d.jsx)("input",{type:"email",id:"user-email",className:l()("authForm__input",{"is-danger":O&&E}),placeholder:"Enter your email",disabled:y||O,value:c,required:!0,onChange:function(e){return o(e.target.value)}}),O&&E&&Object(d.jsx)("p",{className:"is-danger",children:E})]}),O&&Object(d.jsx)(I,{loading:y,errorMessage:E,needToRegister:O,name:f,setName:j}),Object(d.jsx)("button",{type:"submit",className:"submitAuthForm",children:O?"Register":"Login"})]})},U=i.a.createContext(null),_=function(e){var t=e.children,n=Object(s.useState)(null),r=Object(a.a)(n,2),c=r[0],o=r[1];return c?Object(d.jsx)(U.Provider,{value:c,children:t}):Object(d.jsx)(L,{onLogin:o})},D=function(e){var t=e.setTodos,n=e.setIsError,c=Object(s.useState)(""),o=Object(a.a)(c,2),i=o[0],u=o[1],l=Object(s.useContext)(U),f=function(){var e=Object(m.a)(b.a.mark((function e(){var c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l||!i){e.next=4;break}return c={title:i,userId:l.id,completed:!1},e.next=4,k(c).then((function(e){t((function(t){return[].concat(Object(A.a)(t),[e])}))})).catch((function(){n(r.Add)})).finally((function(){u("")}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsxs)("header",{className:"header",children:[Object(d.jsx)("h1",{className:"header__title",children:"".concat(null===l||void 0===l?void 0:l.name,": todos")}),Object(d.jsx)("form",{onSubmit:function(e){e.preventDefault(),f()},children:Object(d.jsx)("input",{type:"text","data-cy":"createTodo",className:"new-todo",placeholder:"What needs to be done?",value:i,onChange:function(e){return u(null===e||void 0===e?void 0:e.target.value)}})})]})},R=n(3),P=function(e){var t=e.todo,n=e.todos,c=e.setTodos,o=e.isActiveField,i=e.setIsActiveField,u=e.setIsError,f=e.filteredTodos,j=e.setTodosList,p=Object(s.useState)(""),h=Object(a.a)(p,2),O=h[0],v=h[1],x=Object(s.useContext)(U),g=function(){var e=Object(m.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!x){e.next=4;break}return u(null),e.next=4,E(t).then((function(){f&&c(f.filter((function(e){return e.id!==t})))})).catch((function(){return u(r.Delete)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){if(x&&f){var e=Object(A.a)(n);if(t.title===O)return;if(!O)return void g(t.id);f.map((function(n,o){return t.id===n.id?function(n,o){u(null);var a={completed:t.completed,title:o};return e[n].title=O,c(e),C(t.id,a).then((function(){return e[n].title=O,e})).catch((function(){j(),u(r.Update)}))}(o,O):[]})),c(e)}},N=function(){y(),i(0)};return Object(d.jsx)("li",{className:l()({editing:o===t.id},{completed:t.completed},{view:o!==t.id}),children:o!==t.id?Object(d.jsxs)("div",{className:"view",children:[Object(d.jsx)("input",{checked:t.completed,type:"checkbox",className:"toggle",onClick:function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(x&&f){var n={completed:e},o=function(e){if(f){var n=Object(A.a)(f);return n[f.indexOf(t)].completed=e,n}return[]};C(t.id,n).then((function(){c(o(e))})).catch((function(){c(o(!e)),u(r.Update)}))}}(!t.completed)}}),Object(d.jsx)("label",{onDoubleClick:function(){return i(t.id)},children:t.title}),Object(d.jsx)("button",{type:"button",className:"destroy","data-cy":"deleteTodo",onClick:function(){return g(t.id)},"aria-label":"delete"})]}):Object(d.jsx)("input",{autoFocus:!0,type:"text",className:"edit",onFocus:function(){return v(t.title)},onChange:function(e){return v(e.target.value)},value:O,onKeyUp:function(e){"Escape"===e.code?(v(t.title),i(0)):"Enter"===e.key&&N()},onBlur:N})})},M=function(e){var t=e.todos,n=e.setTodos,r=e.setTodosList,c=e.filteredTodos,o=e.setIsError,i=Object(s.useState)(0),u=Object(a.a)(i,2),l=u[0],f=u[1];return Object(d.jsx)("ul",{className:"todo-list","data-cy":"todoList",children:c&&c.map((function(e){return Object(d.jsx)(P,{todo:e,isActiveField:l,setIsActiveField:f,setIsError:o,todos:t,setTodos:n,filteredTodos:c,setTodosList:r},e.id)}))})},J=function(e){var t=e.todos,n=e.setTodos,c=e.setIsError,o=e.filter,i=e.setFilter,u=Object(s.useState)(!1),l=Object(a.a)(u,2),f=l[0],j=l[1],b=Object(s.useContext)(U),m=Object(R.i)(),p=function(){var e;b&&(e=b.id,x("/todos?userId=".concat(e))).then((function(e){return n(e)})).catch((function(){c(r.Update),n([])}))},h=Object(s.useCallback)((function(){var e=Object(A.a)(t),o=0,a=function(n,o){return C(t[n].id,{completed:o}).then((function(){return e[n].completed=o,e[n]})).catch((function(){c(r.Update)}))},s=t.map((function(e,t){return e.completed?(o+=1,[]):a(t,!0)}));o===t.length&&(s=t.map((function(e,t){return a(t,!1)}))),Promise.all(s).then((function(){n(e)}))}),[t]),O=Object(s.useMemo)((function(){return function(){if(!t||0===t.length)return null;var e=Object(A.a)(t);return o===v.All?e:e.filter((function(e){switch(o){case v.Active:return!e.completed;case v.Completed:return e.completed;default:return!0}}))}()}),[t,o]);return Object(s.useEffect)((function(){Promise.all([t.every((function(e){return e.completed}))]).then((function(e){var t=Object(a.a)(e,1)[0];return j(t)}))}),[t]),Object(s.useEffect)((function(){p(),function(){var e=m.pathname;switch(!0){case e.includes(v.Completed.toLowerCase()):i(v.Completed);break;case e.includes(v.Active.toLowerCase()):i(v.Active);break;default:i(v.All)}}()}),[m]),Object(d.jsxs)("section",{className:"main",children:[Object(d.jsx)("input",{checked:f,type:"checkbox",id:"toggle-all",className:"toggle-all","data-cy":"toggleAll",onClick:h}),Object(d.jsx)("label",{htmlFor:"toggle-all",children:"Mark all as complete"}),Object(d.jsx)(M,{filteredTodos:O,setIsError:c,todos:t,setTodos:n,setTodosList:p})]})},B=function(){var e=Object(s.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1],c=Object(s.useState)(null),o=Object(a.a)(c,2),i=o[0],u=o[1],l=Object(s.useState)(v.All),j=Object(a.a)(l,2),b=j[0],m=j[1];return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("div",{className:"todoapp",children:[Object(d.jsx)(D,{todos:n,setTodos:r,setIsError:u}),n&&Object(d.jsx)(J,{todos:n,setTodos:r,setIsError:u,filter:b,setFilter:m}),n.length>0&&Object(d.jsx)(w,{todos:n,setTodos:r,setIsError:u,filter:b,setFilter:m})]}),i&&Object(d.jsx)(f,{isError:i,setIsError:u})]})},q=function(){return Object(d.jsx)(o.a,{children:Object(d.jsx)(_,{children:Object(d.jsx)(B,{})})})};Object(c.createRoot)(document.getElementById("root")).render(Object(d.jsx)(q,{}))}},[[39,1,2]]]);
//# sourceMappingURL=main.4e3eaa15.chunk.js.map